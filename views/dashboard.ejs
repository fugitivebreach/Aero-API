<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - AeroAPI</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/dashboard.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#00d4ff;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#00a8cc;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <circle cx="20" cy="20" r="18" stroke="url(#logoGradient)" stroke-width="2" fill="none"/>
                    <path d="M20 8L30 28H10L20 8Z" fill="url(#logoGradient)"/>
                    <circle cx="20" cy="20" r="3" fill="#00d4ff"/>
                </svg>
                <span>AeroAPI</span>
            </div>
            <div class="nav-links">
                <% if (user.is_admin) { %>
                    <a href="/admin" class="nav-link">Admin Panel</a>
                <% } %>
                <div class="user-info">
                    <img src="https://cdn.discordapp.com/avatars/<%= user.discord_id %>/<%= user.discord_avatar %>.png" alt="Avatar" class="user-avatar">
                    <span><%= user.discord_username %></span>
                </div>
                <a href="/logout" class="btn-secondary">Logout</a>
            </div>
        </div>
    </nav>

    <div class="dashboard-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h3>Dashboard</h3>
            </div>
            <nav class="sidebar-nav">
                <a href="#" class="sidebar-link active" data-tab="api-keys">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/>
                    </svg>
                    API Keys
                </a>
                <div class="sidebar-dropdown">
                    <a href="#" class="sidebar-link" data-dropdown="api-docs">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                        </svg>
                        API Documentation
                        <svg class="dropdown-arrow" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"/>
                        </svg>
                    </a>
                    <div class="dropdown-menu" id="api-docs-menu">
                        <a href="#" class="dropdown-item" data-tab="api-setrank">Set Rank API</a>
                        <a href="#" class="dropdown-item" data-tab="api-validate">Validate Key API</a>
                        <a href="#" class="dropdown-item" data-tab="api-requirements">API Requirements</a>
                    </div>
                </div>
            </nav>
        </aside>

        <main class="dashboard-main">
            <% if (moderationStatus.isLocked || moderationStatus.isDisabled || moderationStatus.isRatelimited) { %>
                <div class="moderation-warning animate-slide-down">
                    <div class="warning-icon">
                        <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#ff4444" stroke-width="2">
                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                            <line x1="12" y1="9" x2="12" y2="13"/>
                            <line x1="12" y1="17" x2="12.01" y2="17"/>
                        </svg>
                    </div>
                    <h2>Your account has been <%= moderationStatus.actionType %></h2>
                    <div class="warning-reason">
                        <strong>Reason:</strong>
                        <p><%= moderationStatus.reason %></p>
                    </div>
                </div>
            <% } else { %>
                <div id="api-keys-tab" class="tab-content active">
                    <div class="tab-header">
                        <h2>API Key Management</h2>
                        <button class="btn-primary" onclick="generateApiKey()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"/>
                                <line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                            Generate New Key
                        </button>
                    </div>

                    <div id="api-keys-container" class="api-keys-grid">
                        <div class="loading-spinner">Loading...</div>
                    </div>
                </div>

                <div id="api-setrank-tab" class="tab-content">
                    <div class="api-doc-header">
                        <h2>Set Rank API</h2>
                        <p class="api-doc-subtitle">Set a user's rank in a Roblox group</p>
                    </div>

                    <div class="api-doc-section">
                        <div class="api-endpoint">
                            <span class="http-method post">POST</span>
                            <code class="endpoint-url">/api/setrank</code>
                        </div>

                        <div class="doc-card">
                            <h3>Authentication</h3>
                            <div class="auth-badge">Required</div>
                            <p>Learn how to get your API Key and use it in your requests!</p>
                        </div>

                        <div class="doc-card">
                            <h3>URL Parameters</h3>
                            <p>None required</p>
                        </div>

                        <div class="doc-card">
                            <h3>Request Headers</h3>
                            <div class="code-block">
                                <div class="code-header">
                                    <span>Headers</span>
                                </div>
                                <pre><code>api-key: <span class="code-string">"AeroAPI-your-api-key-here"</span>
Content-Type: <span class="code-string">"application/json"</span></code></pre>
                            </div>
                        </div>

                        <div class="doc-card">
                            <h3>Request Body</h3>
                            <div class="param-table">
                                <div class="param-row">
                                    <div class="param-name">roblox-cookie</div>
                                    <div class="param-type">string</div>
                                    <div class="param-required">required</div>
                                </div>
                                <div class="param-row">
                                    <div class="param-name">group-id</div>
                                    <div class="param-type">number</div>
                                    <div class="param-required">required</div>
                                </div>
                                <div class="param-row">
                                    <div class="param-name">rank-id</div>
                                    <div class="param-type">number</div>
                                    <div class="param-required">required</div>
                                </div>
                                <div class="param-row">
                                    <div class="param-name">roblox-username</div>
                                    <div class="param-type">string</div>
                                    <div class="param-required">required</div>
                                </div>
                            </div>
                        </div>

                        <div class="doc-card">
                            <h3>Responses</h3>
                            <div class="response-section">
                                <div class="response-code success">200 - Success</div>
                                <div class="code-block">
                                    <pre><code>{
  <span class="code-key">"roblox-username"</span>: <span class="code-string">"targetUser"</span>,
  <span class="code-key">"roblox-id"</span>: <span class="code-number">123456789</span>,
  <span class="code-key">"roblox-profile"</span>: <span class="code-string">"https://www.roblox.com/users/123456789/profile"</span>,
  <span class="code-key">"group-id"</span>: <span class="code-number">123456</span>,
  <span class="code-key">"rank-id"</span>: <span class="code-number">255</span>,
  <span class="code-key">"returnCode"</span>: <span class="code-number">200</span>
}</code></pre>
                                </div>
                            </div>
                            <div class="response-section">
                                <div class="response-code error">400 - Bad Request</div>
                                <div class="code-block">
                                    <pre><code>{
  <span class="code-key">"valid"</span>: <span class="code-boolean">false</span>,
  <span class="code-key">"message"</span>: <span class="code-string">"The Roblox cookie you input is invalid"</span>
}</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="api-validate-tab" class="tab-content">
                    <div class="api-doc-header">
                        <h2>Validate Key API</h2>
                        <p class="api-doc-subtitle">Validate an API key and check its status</p>
                    </div>

                    <div class="api-doc-section">
                        <div class="api-endpoint">
                            <span class="http-method get">GET</span>
                            <code class="endpoint-url">/api/validate-key/:apiKey</code>
                        </div>

                        <div class="doc-card">
                            <h3>Authentication</h3>
                            <div class="auth-badge public">Public</div>
                            <p>No authentication required for this endpoint</p>
                        </div>

                        <div class="doc-card">
                            <h3>URL Parameters</h3>
                            <div class="param-table">
                                <div class="param-row">
                                    <div class="param-name">apiKey</div>
                                    <div class="param-type">string</div>
                                    <div class="param-required">required</div>
                                </div>
                            </div>
                        </div>

                        <div class="doc-card">
                            <h3>Responses</h3>
                            <div class="response-section">
                                <div class="response-code success">200 - Valid Key</div>
                                <div class="code-block">
                                    <pre><code>{
  <span class="code-key">"valid"</span>: <span class="code-boolean">true</span>,
  <span class="code-key">"user"</span>: {
    <span class="code-key">"discord_username"</span>: <span class="code-string">"username#0000"</span>,
    <span class="code-key">"discord_id"</span>: <span class="code-string">"123456789012345678"</span>
  }
}</code></pre>
                                </div>
                            </div>
                            <div class="response-section">
                                <div class="response-code error">404 - Invalid Key</div>
                                <div class="code-block">
                                    <pre><code>{
  <span class="code-key">"valid"</span>: <span class="code-boolean">false</span>,
  <span class="code-key">"message"</span>: <span class="code-string">"The API Key you input no longer exists"</span>
}</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="api-requirements-tab" class="tab-content">
                    <div class="api-doc-header">
                        <h2>API Requirements</h2>
                        <p class="api-doc-subtitle">Technical requirements and specifications</p>
                    </div>

                    <div class="api-doc-section">
                        <div class="doc-card">
                            <h3>Technical Requirements</h3>
                            <div class="requirements-grid">
                                <div class="requirement-item">
                                    <strong>Protocol:</strong>
                                    <span>HTTPS (TLS 1.2+)</span>
                                </div>
                                <div class="requirement-item">
                                    <strong>Content Type:</strong>
                                    <span>application/json</span>
                                </div>
                                <div class="requirement-item">
                                    <strong>Authentication:</strong>
                                    <span>API Key (Header-based)</span>
                                </div>
                                <div class="requirement-item">
                                    <strong>Character Encoding:</strong>
                                    <span>UTF-8</span>
                                </div>
                            </div>
                        </div>

                        <div class="doc-card">
                            <h3>API Key Format</h3>
                            <div class="code-block">
                                <pre><code>AeroAPI-[UUID]

<span class="code-comment">// Example:</span>
AeroAPI-a1b2c3d4-e5f6-7890-abcd-ef1234567890</code></pre>
                            </div>
                        </div>

                        <div class="doc-card">
                            <h3>Rate Limiting</h3>
                            <div class="requirements-grid">
                                <div class="requirement-item">
                                    <strong>Standard Endpoints:</strong>
                                    <span>60 requests/minute</span>
                                </div>
                                <div class="requirement-item">
                                    <strong>Validation Endpoints:</strong>
                                    <span>120 requests/minute</span>
                                </div>
                                <div class="requirement-item">
                                    <strong>Key Generation:</strong>
                                    <span>10 requests/minute</span>
                                </div>
                            </div>
                        </div>

                        <div class="doc-card">
                            <h3>Common Error Messages</h3>
                            <div class="error-list">
                                <div class="error-item">
                                    <code>The API Key you input no longer exists</code>
                                    <p>Invalid or deleted API key - Generate a new key</p>
                                </div>
                                <div class="error-item">
                                    <code>The API Key you input is ratelimited</code>
                                    <p>Rate limit exceeded - Wait before retrying</p>
                                </div>
                                <div class="error-item">
                                    <code>The Roblox cookie you input is invalid</code>
                                    <p>Invalid or expired cookie - Update Roblox cookie</p>
                                </div>
                                <div class="error-item">
                                    <code>You do not have permission to manage this group</code>
                                    <p>Insufficient permissions - Use account with group permissions</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            <% } %>
        </main>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Generate API Key</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modal-body">
                <div class="form-group">
                    <label for="key-name">Key Name (Optional)</label>
                    <input type="text" id="key-name" placeholder="My API Key" class="form-input">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal()">Cancel</button>
                <button class="btn-primary" onclick="confirmGenerate()">Generate</button>
            </div>
        </div>
    </div>

    <script>
        const moderationStatus = <%- JSON.stringify(moderationStatus) %>;
    </script>
    <script src="/js/dashboard.js"></script>
</body>
</html>
